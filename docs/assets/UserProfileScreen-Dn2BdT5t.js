import{j as e,D as J,c as K,B as i,e as t,I as b,U as _,d as Q,b8 as n,f as X,g as z,bU as T,P as k,C as h,n as u,bV as Y,z as A,aV as Z,m as R,a4 as ee,bA as te,E as re,aN as se,J as ae,K as ie,N as oe,v as F,r as ne}from"./mui-DHtKCVyI.js";import{r as g}from"./vendor-B0qVADJY.js";import{G as le,m as I}from"./index-Bme_WGpp.js";import{D as ce,i as de,g as L}from"./avatarUtils-WOXNzkwt.js";import{f as xe,v as he,a as G,s as D}from"./profileUtils-DW-d_yQV.js";import"./firebase-CJLtoEJQ.js";const V=({open:a,onClose:o,onSelect:B,currentAvatar:f})=>{const[m,C]=g.useState(f),d=r=>{C(r)},j=()=>{m&&(B(m),o())},p=()=>{C(f),o()},S=r=>{const x=m===r.id;return e.jsx(n,{item:!0,xs:6,sm:3,children:e.jsxs(i,{onClick:()=>d(r.id),sx:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:1,p:1,borderRadius:2,border:2,borderColor:x?"primary.main":"transparent",bgcolor:x?"action.selected":"transparent",transition:"all 0.2s","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(T,{src:r.url,sx:{width:80,height:80}}),e.jsx(t,{variant:"caption",color:"text.secondary",children:r.label})]})},r.id)};return e.jsxs(J,{open:a,onClose:p,maxWidth:"sm",fullWidth:!0,children:[e.jsx(K,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(t,{variant:"h6",children:"Choose Dog Avatar"}),e.jsx(b,{onClick:p,size:"small",children:e.jsx(_,{})})]})}),e.jsx(Q,{children:e.jsxs(i,{sx:{mt:2},children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,sx:{mb:2},children:"Select a doggo as your avatar"}),e.jsx(n,{container:!0,spacing:2,children:ce.map(r=>S(r))})]})}),e.jsxs(X,{sx:{p:2,pt:0},children:[e.jsx(z,{onClick:p,color:"inherit",children:"Cancel"}),e.jsx(z,{onClick:j,variant:"contained",disabled:!m,children:"Save"})]})]})};V.propTypes={open:k.bool.isRequired,onClose:k.func.isRequired,onSelect:k.func.isRequired,currentAvatar:k.string};const ye=()=>{const{profile:a,stats:o,loading:B,saveProfile:f,updateProfile:m,getProfileCompletion:C}=le(),[d,j]=g.useState(!1),[p,S]=g.useState(!1),[r,x]=g.useState(a),[l,W]=g.useState({}),[N,v]=g.useState(null);g.useEffect(()=>{x(a)},[a]);const O=()=>{j(!0),W({}),v(null)},$=()=>{j(!1),x(a),W({}),v(null)},q=async()=>{const s={},c=he(r.displayName);c.valid||(s.displayName=c.error);const w=G(r.bio,500);w.valid||(s.bio=w.error);const U=G(r.goals,500);if(U.valid||(s.goals=U.error),Object.keys(s).length>0){W(s);return}try{const P={...r,displayName:D(r.displayName),bio:D(r.bio),goals:D(r.goals)};await f(P),j(!1),v(null)}catch(P){console.error("Error saving profile:",P),v("Failed to save profile. Please try again.")}},y=(s,c)=>{x({...r,[s]:c}),l[s]&&W({...l,[s]:null})},M=async s=>{try{await m("avatar",s),x({...r,avatar:s})}catch(c){console.error("Error updating avatar:",c),v("Failed to update avatar. Please try again.")}},H=()=>{if(a.avatar&&de(a.avatar)){const w=L(a.avatar);return e.jsx(T,{src:w,sx:{width:100,height:100}})}const c=L("doggo-1");return e.jsx(T,{src:c,sx:{width:100,height:100}})},E=C();return B?e.jsx(i,{sx:{p:3},children:e.jsxs(t,{color:"text.secondary",children:["Loading profile",e.jsx(I.span,{initial:{opacity:0},animate:{opacity:[0,1,0]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:"..."})]})}):e.jsxs(i,{sx:{minHeight:"100vh",padding:{xs:2,sm:3,md:4},paddingBottom:{xs:"80px",sm:3,md:4},background:s=>s.palette.background.default},children:[e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(t,{variant:"h4",sx:{mb:3,fontWeight:700,color:"text.primary"},children:"Profile"}),e.jsx(h,{sx:{mb:3,borderRadius:2},children:e.jsxs(u,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:3,mb:3},children:[e.jsxs(i,{sx:{position:"relative",alignSelf:{xs:"center",sm:"flex-start"}},children:[e.jsx(i,{sx:{borderRadius:"50%",overflow:"hidden",width:100,height:100,border:"2px solid",borderColor:"divider"},children:H()}),e.jsx(b,{onClick:()=>S(!0),size:"small",sx:{position:"absolute",bottom:-4,right:-4,bgcolor:"primary.main",color:"white",boxShadow:2,"&:hover":{bgcolor:"primary.dark",boxShadow:4}},children:e.jsx(Y,{fontSize:"small"})})]}),e.jsxs(i,{sx:{flex:1},children:[d?e.jsx(A,{fullWidth:!0,label:"Display Name",value:r.displayName,onChange:s=>y("displayName",s.target.value),error:!!l.displayName,helperText:l.displayName,sx:{mb:2}}):e.jsx(t,{variant:"h5",fontWeight:700,gutterBottom:!0,children:a.displayName||"Unknown User"}),e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:a.email}),e.jsxs(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Member since ",xe(a.memberSince)]}),e.jsxs(i,{sx:{mt:2},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",fontWeight:600,children:"Profile Completion"}),e.jsxs(t,{variant:"body2",fontWeight:600,children:[E,"%"]})]}),e.jsx(Z,{variant:"determinate",value:E,sx:{height:8,borderRadius:4}})]})]}),e.jsx(i,{children:d?e.jsxs(R,{direction:"row",spacing:1,children:[e.jsx(b,{color:"primary",onClick:q,children:e.jsx(ee,{})}),e.jsx(b,{onClick:$,children:e.jsx(te,{})})]}):e.jsx(b,{color:"primary",onClick:O,children:e.jsx(re,{})})})]}),N&&e.jsx(se,{severity:"error",sx:{mb:2},children:N}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Bio"}),d?e.jsx(A,{fullWidth:!0,multiline:!0,rows:3,value:r.bio,onChange:s=>y("bio",s.target.value),error:!!l.bio,helperText:l.bio||`${r.bio.length}/500`,placeholder:"Tell us about yourself..."}):e.jsx(t,{variant:"body2",color:"text.secondary",children:a.bio||"No bio yet"})]}),e.jsxs(i,{children:[e.jsx(t,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Fitness Goals"}),d?e.jsx(A,{fullWidth:!0,multiline:!0,rows:3,value:r.goals,onChange:s=>y("goals",s.target.value),error:!!l.goals,helperText:l.goals||`${r.goals.length}/500`,placeholder:"What are your fitness goals?"}):e.jsx(t,{variant:"body2",color:"text.secondary",children:a.goals||"No goals set yet"})]}),e.jsxs(i,{sx:{mt:2},children:[e.jsx(t,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Target Weight"}),d?e.jsxs(R,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(A,{type:"number",label:"Target Weight",value:r.targetWeight||"",onChange:s=>y("targetWeight",s.target.value?parseFloat(s.target.value):null),inputProps:{step:.1,min:0},sx:{flex:1,maxWidth:200}}),e.jsxs(ae,{size:"small",sx:{minWidth:80},children:[e.jsx(ie,{children:"Unit"}),e.jsxs(oe,{value:r.weightUnit||"lbs",onChange:s=>y("weightUnit",s.target.value),label:"Unit",children:[e.jsx(F,{value:"lbs",children:"lbs"}),e.jsx(F,{value:"kg",children:"kg"})]})]})]}):e.jsx(t,{variant:"body2",color:"text.secondary",children:a.targetWeight?`${a.targetWeight} ${a.weightUnit||"lbs"}`:"No target weight set"})]})]})}),e.jsxs(n,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(n,{item:!0,xs:6,sm:4,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total Workouts"}),e.jsx(t,{variant:"h4",fontWeight:700,children:o.totalWorkouts})]})})}),e.jsx(n,{item:!0,xs:6,sm:4,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Current Streak"}),e.jsx(t,{variant:"h4",fontWeight:700,color:"warning.main",children:o.currentStreak}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"days"})]})})}),e.jsx(n,{item:!0,xs:6,sm:4,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Longest Streak"}),e.jsx(t,{variant:"h4",fontWeight:700,children:o.longestStreak}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"days"})]})})}),e.jsx(n,{item:!0,xs:6,sm:4,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Total PRs"}),e.jsx(t,{variant:"h4",fontWeight:700,color:"success.main",children:o.totalPRs})]})})}),e.jsx(n,{item:!0,xs:6,sm:4,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Wellness Tasks"}),e.jsx(t,{variant:"h4",fontWeight:700,color:"secondary.main",children:o.completedWellnessTasks||0}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"completed"})]})})}),e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsx(h,{children:e.jsxs(u,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Favorite Exercise"}),e.jsx(ne,{label:o.favoriteExercise||"No data yet",color:"primary",sx:{mt:1}})]})})})]})]}),e.jsx(V,{open:p,onClose:()=>S(!1),onSelect:M,currentAvatar:a.avatar})]})};export{ye as default};
