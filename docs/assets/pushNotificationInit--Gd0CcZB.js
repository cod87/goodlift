import{g as h}from"./pushNotificationService-C2m6P97J.js";import"./index-Bme_WGpp.js";import"./mui-DHtKCVyI.js";import"./vendor-B0qVADJY.js";import"./firebase-CJLtoEJQ.js";function f(s){const o="=".repeat((4-s.length%4)%4),i=(s+o).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(i),r=new Uint8Array(e.length);for(let n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}async function g(s){try{if(console.log("[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Notifications] Starting push notification subscription..."),!("serviceWorker"in navigator))return console.error("[Push Notifications] âŒ Service Workers are not supported in this browser"),console.error("[Push Notifications] Browser:",navigator.userAgent),console.error("[Push Notifications] Push notifications require service worker support"),null;if(console.log("[Push Notifications] âœ… Service Workers supported"),!("PushManager"in window))return console.error("[Push Notifications] âŒ Push Manager API is not supported in this browser"),console.error("[Push Notifications] Browser:",navigator.userAgent),console.error("[Push Notifications] This browser does not support Web Push"),null;if(console.log("[Push Notifications] âœ… Push Manager API supported"),!("Notification"in window))return console.error("[Push Notifications] âŒ Notification API is not supported in this browser"),console.error("[Push Notifications] Browser:",navigator.userAgent),null;console.log("[Push Notifications] âœ… Notification API supported");const o=Notification.permission;if(console.log("[Push Notifications] Current permission state:",o),o==="denied")return console.error("[Push Notifications] âŒ Notification permission denied by user"),console.error("[Push Notifications] User must manually enable notifications in browser settings:"),console.error("[Push Notifications]   Chrome: Site Settings > Notifications"),console.error("[Push Notifications]   Firefox: Page Info > Permissions > Notifications"),console.error("[Push Notifications]   Safari: Safari > Settings > Websites > Notifications"),console.error("[Push Notifications]   Edge: Site Permissions > Notifications"),null;if(o!=="granted"){console.log("[Push Notifications] Requesting notification permission from user..."),console.log("[Push Notifications] User will see a permission prompt");const t=await Notification.requestPermission();if(console.log("[Push Notifications] Permission request result:",t),t!=="granted")return console.warn("[Push Notifications] âš ï¸  Notification permission not granted:",t),t==="denied"?console.error("[Push Notifications] User denied permission - cannot proceed"):console.warn("[Push Notifications] User dismissed permission prompt"),null;console.log("[Push Notifications] âœ… Notification permission granted")}else console.log("[Push Notifications] âœ… Notification permission already granted");console.log("[Push Notifications] Waiting for service worker to be ready..."),console.log("[Push Notifications] This ensures service worker is fully registered and active");const i=await navigator.serviceWorker.ready;if(console.log("[Push Notifications] âœ… Service worker is ready"),console.log("[Push Notifications] Service worker scope:",i.scope),console.log("[Push Notifications] Service worker active:",i.active!==null),!i.active)return console.error("[Push Notifications] âŒ Service worker is not active"),console.error("[Push Notifications] Cannot subscribe without an active service worker"),null;console.log("[Push Notifications] Checking for existing push subscription...");const e=await i.pushManager.getSubscription();if(e)return console.log("[Push Notifications] âš ï¸  Already subscribed to push notifications"),console.log("[Push Notifications] Existing subscription endpoint:",e.endpoint.substring(0,50)+"..."),console.log("[Push Notifications] Returning existing subscription"),e;console.log("[Push Notifications] No existing subscription found"),console.log("[Push Notifications] Converting VAPID key to Uint8Array format..."),console.log("[Push Notifications] VAPID key (first 20 chars):",s.substring(0,20)+"...");let r;try{r=f(s),console.log("[Push Notifications] âœ… VAPID key converted successfully"),console.log("[Push Notifications] Converted key length:",r.length,"bytes")}catch(t){throw console.error("[Push Notifications] âŒ Error converting VAPID key:",t),console.error("[Push Notifications] VAPID key may be invalid or corrupted"),t}console.log("[Push Notifications] Subscribing to push notifications..."),console.log("[Push Notifications] Options: userVisibleOnly = true (required)");const n=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r});return console.log("[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Notifications] âœ… Successfully subscribed to push notifications!"),console.log("[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Notifications] ğŸ“‹ Subscription Details:"),console.log("[Push Notifications] Endpoint:",n.endpoint),n.keys&&(console.log("[Push Notifications] Keys available:"),console.log("[Push Notifications]   - p256dh:",n.keys.p256dh?"Present":"Missing"),console.log("[Push Notifications]   - auth:",n.keys.auth?"Present":"Missing")),console.log("[Push Notifications] Full subscription object:"),console.log(JSON.stringify(n,null,2)),console.log(`
[Push Notifications] ğŸ“¤ Next Steps:`),console.log("[Push Notifications] 1. Send this subscription object to your backend server"),console.log("[Push Notifications] 2. Store it in your database associated with this user/device"),console.log("[Push Notifications] 3. Use it to send push notifications via web-push library"),console.log(`
[Push Notifications] Example backend code (Node.js with web-push):`),console.log('[Push Notifications] const webpush = require("web-push");'),console.log('[Push Notifications] webpush.sendNotification(subscription, "Your notification message");'),console.log(`[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`),n}catch(o){return console.error("[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.error("[Push Notifications] âŒ Error subscribing to push notifications"),console.error("[Push Notifications] Error name:",o.name),console.error("[Push Notifications] Error message:",o.message),o.name==="NotAllowedError"?(console.error("[Push Notifications] Permission not allowed by user"),console.error("[Push Notifications] This can happen if:"),console.error("[Push Notifications]   - User denied permission"),console.error("[Push Notifications]   - Permission request not triggered by user action (iOS)"),console.error("[Push Notifications]   - Browser blocked permission request")):o.name==="NotSupportedError"?(console.error("[Push Notifications] Push notifications not supported"),console.error("[Push Notifications] Browser may be too old or feature is disabled")):o.name==="AbortError"?(console.error("[Push Notifications] Subscription aborted"),console.error("[Push Notifications] Service worker may not be properly registered")):o.name==="InvalidStateError"?(console.error("[Push Notifications] Invalid state"),console.error("[Push Notifications] Service worker may not be active")):o.message.includes("VAPID")&&(console.error("[Push Notifications] VAPID key issue"),console.error("[Push Notifications] Check that VAPID key is correct and properly formatted")),console.error("[Push Notifications] Full error object:",o),console.error("[Push Notifications] Stack trace:",o.stack),console.error("[Push Notifications] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),null}}async function p(){try{if(console.log("[Push Notifications] Checking for existing subscription..."),!("serviceWorker"in navigator)||!("PushManager"in window))return console.warn("[Push Notifications] âš ï¸  Service Workers or Push Manager not supported"),null;const o=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return o?(console.log("[Push Notifications] âœ… Found existing subscription"),console.log("[Push Notifications] Endpoint:",o.endpoint.substring(0,50)+"..."),console.log("[Push Notifications] Expiration time:",o.expirationTime||"Never")):console.log("[Push Notifications] No existing subscription found"),o}catch(s){return console.error("[Push Notifications] âŒ Error checking existing subscription"),console.error("[Push Notifications] Error name:",s.name),console.error("[Push Notifications] Error message:",s.message),null}}function a(){const s=navigator.userAgent,o=navigator.vendor||"",i=/^((?!chrome|android).)*safari/i.test(s)&&/apple/i.test(o),e=/iPad|iPhone|iPod/.test(s)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,r=/Chrome/.test(s)&&/Google Inc/.test(o)&&!/Edge/.test(s),n=/Firefox/.test(s),t=/Edg/.test(s),u=/OPR/.test(s),l=navigator.brave?.isBrave?.name==="isBrave";return{isSafari:i,isIOS:e,isChrome:r,isFirefox:n,isEdge:t,isOpera:u,isBrave:l,userAgent:s,vendor:o,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints}}function c(){const s=a(),o={serviceWorker:"serviceWorker"in navigator,pushManager:"PushManager"in window,notification:"Notification"in window,messaging:null,browser:s,isFullySupported:!1,warnings:[],errors:[]};return o.isFullySupported=o.serviceWorker&&o.pushManager&&o.notification,(s.isSafari||s.isIOS)&&(s.isIOS&&parseFloat(navigator.userAgent.match(/OS (\d+)_/)?.[1])<16?(o.errors.push("iOS version too old for push notifications (requires iOS 16.4+)"),o.isFullySupported=!1):s.isIOS&&(o.warnings.push("iOS/Safari push notifications have limited support and require explicit user action"),o.warnings.push("Push notifications may not work in standalone mode (added to home screen)")),s.isSafari&&!s.isIOS&&o.warnings.push("Safari desktop push notifications require macOS 13+ (Ventura or later)")),o.serviceWorker||o.errors.push("Service Workers are not supported in this browser"),o.pushManager||o.errors.push("Push Manager API is not supported in this browser"),o.notification||o.errors.push("Notification API is not supported in this browser"),!window.isSecureContext&&location.hostname!=="localhost"&&(o.errors.push("Push notifications require HTTPS (secure context)"),o.isFullySupported=!1),o}function P(){const s=a(),o=c();let i=`=== Browser Information ===
`;if(s.isChrome?i+=`Browser: Google Chrome
`:s.isFirefox?i+=`Browser: Mozilla Firefox
`:s.isEdge?i+=`Browser: Microsoft Edge
`:s.isSafari?i+=`Browser: Safari
`:s.isOpera?i+=`Browser: Opera
`:s.isBrave?i+=`Browser: Brave
`:i+=`Browser: Unknown
`,s.isIOS){i+=`Platform: iOS
`;const e=navigator.userAgent.match(/OS (\d+)_(\d+)/);e&&(i+=`iOS Version: ${e[1]}.${e[2]}
`)}else i+=`Platform: ${s.platform}
`;return i+=`
=== Push Notification Support ===
`,i+=`Service Worker: ${o.serviceWorker?"âœ… Supported":"âŒ Not Supported"}
`,i+=`Push Manager: ${o.pushManager?"âœ… Supported":"âŒ Not Supported"}
`,i+=`Notification API: ${o.notification?"âœ… Supported":"âŒ Not Supported"}
`,i+=`Secure Context: ${window.isSecureContext?"âœ… Yes":"âŒ No"}
`,i+=`Fully Supported: ${o.isFullySupported?"âœ… Yes":"âŒ No"}
`,o.warnings.length>0&&(i+=`
âš ï¸  Warnings:
`,o.warnings.forEach(e=>{i+=`  - ${e}
`})),o.errors.length>0&&(i+=`
âŒ Errors:
`,o.errors.forEach(e=>{i+=`  - ${e}
`})),i}function d(){console.log(`[Browser Detection]
`+P())}const m="BE0ZQSJHIlmXfeA5ddjITNrqrS0TmGfGGQjBufmOlUKxRUtEwja2qHmTZ0pXHepJzGV2qcwH0gJ_D6ot6cWGB6w";async function v(){try{console.log("[Push Init] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Init] Starting push notification initialization..."),console.log("[Push Init] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Init] Step 1: Checking browser and platform compatibility..."),d();const s=c(),o=a();if((o.isSafari||o.isIOS)&&(console.warn("[Push Init] âš ï¸  Safari/iOS detected"),o.isIOS&&(console.warn("[Push Init] ğŸ“± iOS push notifications have limited support:"),console.warn("[Push Init]   - Requires iOS 16.4 or later"),console.warn("[Push Init]   - Must be triggered by explicit user action (tap/click)"),console.warn("[Push Init]   - May not work in standalone mode (home screen app)"),console.warn("[Push Init]   - Background push is limited compared to Chrome/Firefox")),o.isSafari&&!o.isIOS&&(console.warn("[Push Init] ğŸ–¥ï¸  Safari desktop push notifications:"),console.warn("[Push Init]   - Requires macOS 13 (Ventura) or later"),console.warn("[Push Init]   - Limited compared to Chrome/Firefox"))),!s.isFullySupported){console.error("[Push Init] âŒ Push notifications are not fully supported in this browser"),s.errors.length>0&&(console.error("[Push Init] Blocking issues:"),s.errors.forEach(i=>console.error(`[Push Init]   - ${i}`))),console.error("[Push Init] Push notification initialization aborted");return}console.log("[Push Init] âœ… Browser supports push notifications"),console.log("[Push Init] Setting up both Firebase Cloud Messaging and native Web Push API"),console.log("[Push Init] Step 2: Initializing Firebase Cloud Messaging...");try{const i=await h();i?(console.log("[Push Init] âœ… Firebase Cloud Messaging initialized successfully"),console.log("[Push Init] ğŸ“‹ FCM Token:",i.substring(0,20)+"..."),console.log("[Push Init] ğŸ“¤ Send this token to your backend to enable Firebase push notifications")):(console.warn("[Push Init] âš ï¸  Firebase Cloud Messaging not available"),console.warn("[Push Init] This may be expected on Safari/iOS or if permission was denied"),(o.isSafari||o.isIOS)&&(console.warn("[Push Init] Safari/iOS does not support Firebase Cloud Messaging"),console.warn("[Push Init] Will attempt native Web Push API instead")))}catch(i){console.error("[Push Init] âŒ Error initializing Firebase Cloud Messaging:",i),console.error("[Push Init] Error name:",i.name),console.error("[Push Init] Error message:",i.message),(o.isSafari||o.isIOS)&&console.warn("[Push Init] This is expected on Safari/iOS - FCM is not supported")}console.log("[Push Init] Step 3: Initializing native Web Push API...");try{if(!("serviceWorker"in navigator))throw new Error("Service Workers not supported");const i=Notification.permission;if(console.log("[Push Init] Current notification permission:",i),i==="denied"){console.error("[Push Init] âŒ Notification permission denied by user"),console.error("[Push Init] User must manually enable notifications in browser settings"),console.error("[Push Init] On Chrome: Site Settings > Notifications"),console.error("[Push Init] On Firefox: Page Info > Permissions > Notifications"),console.error("[Push Init] On Safari: Safari > Settings > Websites > Notifications");return}const e=await p();e?(console.log("[Push Init] âœ… Native Web Push: Already subscribed"),console.log("[Push Init] Subscription endpoint:",e.endpoint.substring(0,50)+"..."),console.log("[Push Init] Subscription keys available:",{p256dh:!!e.keys?.p256dh,auth:!!e.keys?.auth})):(console.log("[Push Init] Native Web Push: No existing subscription found"),i==="default"?(console.log("[Push Init] â„¹ï¸  Notification permission not yet requested"),console.log("[Push Init] Permission will be requested when user interacts with notification features"),console.log("[Push Init] Call requestPushNotificationSubscription() to request permission manually"),o.isIOS&&(console.warn("[Push Init] âš ï¸  iOS requires explicit user action to request permission"),console.warn("[Push Init] Automatic permission request may not work"))):i==="granted"&&(console.log("[Push Init] Permission already granted, creating subscription..."),await g(m)?console.log("[Push Init] âœ… Native Web Push: Subscription created successfully"):(console.warn("[Push Init] âš ï¸  Native Web Push: Subscription not created"),console.warn("[Push Init] Check previous error messages for details"))))}catch(i){console.error("[Push Init] âŒ Error initializing native Web Push API:",i),console.error("[Push Init] Error name:",i.name),console.error("[Push Init] Error message:",i.message),console.error("[Push Init] Stack trace:",i.stack),o.isIOS?(console.error("[Push Init] iOS troubleshooting:"),console.error("[Push Init]   - Ensure iOS version is 16.4 or later"),console.error("[Push Init]   - Try requesting permission from a user action (button click)"),console.error("[Push Init]   - Check if app is in standalone mode (may have limitations)")):o.isSafari&&(console.error("[Push Init] Safari troubleshooting:"),console.error("[Push Init]   - Ensure macOS is version 13 (Ventura) or later"),console.error("[Push Init]   - Check Safari settings for notification permissions"))}console.log(`
[Push Init] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`),console.log("[Push Init] ğŸ‰ Push notification initialization complete!"),console.log("[Push Init] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[Push Init] Summary:"),console.log("[Push Init] - Browser compatibility checked âœ“"),console.log("[Push Init] - FCM initialization attempted âœ“"),console.log("[Push Init] - Native Web Push setup attempted âœ“"),console.log("[Push Init]"),console.log("[Push Init] Next steps:"),console.log("[Push Init] 1. Send FCM token and/or Web Push subscription to your backend"),console.log("[Push Init] 2. Store them in your database associated with the user"),console.log("[Push Init] 3. Use them to send push notifications from your server"),console.log(`[Push Init] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`)}catch(s){console.error("[Push Init] âŒ Fatal error during push notification initialization:",s),console.error("[Push Init] Error name:",s.name),console.error("[Push Init] Error message:",s.message),console.error("[Push Init] Stack trace:",s.stack)}}export{v as initializePushNotifications};
