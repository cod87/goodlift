<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/goodlift/goodlift-favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>GoodLift - Strength Training & Workout Tracking</title>
    <meta name="description" content="Strength training and workout tracking designed for progress." />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    
    <!-- iOS PWA Support -->
    <link rel="apple-touch-icon" href="icons/goodlift-icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="GoodLift" />
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#2a3647" />
    <meta name="msapplication-TileColor" content="#2a3647" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script type="module" crossorigin src="/goodlift/assets/index-GE1imYoz.js"></script>
    <link rel="modulepreload" crossorigin href="/goodlift/assets/vendor-B0qVADJY.js">
    <link rel="modulepreload" crossorigin href="/goodlift/assets/mui-DuxjqHhH.js">
    <link rel="modulepreload" crossorigin href="/goodlift/assets/firebase-BNDukJBA.js">
    <link rel="modulepreload" crossorigin href="/goodlift/assets/charts-BxauoDrX.js">
    <link rel="stylesheet" crossorigin href="/goodlift/assets/index-DjFMcck1.css">
  </head>
  <body>
    <div id="root"></div>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          console.log('[SW Registration] Starting service worker registration...');
          console.log('[SW Registration] Current URL:', window.location.href);
          console.log('[SW Registration] Is Secure Context:', window.isSecureContext);
          
          navigator.serviceWorker.register('/goodlift/service-worker.js')
            .then(registration => {
              console.log('[SW Registration] ‚úÖ Service Worker registered successfully');
              console.log('[SW Registration] Scope:', registration.scope);
              console.log('[SW Registration] Active:', registration.active !== null);
              console.log('[SW Registration] Installing:', registration.installing !== null);
              console.log('[SW Registration] Waiting:', registration.waiting !== null);
              
              // Listen for updates
              registration.addEventListener('updatefound', () => {
                console.log('[SW Registration] üîÑ Service Worker update found');
                const newWorker = registration.installing;
                
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    console.log('[SW Registration] Service Worker state changed to:', newWorker.state);
                    if (newWorker.state === 'activated') {
                      console.log('[SW Registration] ‚úÖ New Service Worker activated');
                    }
                  });
                }
              });
              
              // Check for existing service worker
              if (registration.active) {
                console.log('[SW Registration] Service Worker already active and controlling pages');
              } else if (registration.installing) {
                console.log('[SW Registration] Service Worker is installing...');
              } else if (registration.waiting) {
                console.log('[SW Registration] Service Worker is waiting to activate...');
              }
            })
            .catch(error => {
              console.error('[SW Registration] ‚ùå Service Worker registration failed');
              console.error('[SW Registration] Error type:', error.name);
              console.error('[SW Registration] Error message:', error.message);
              console.error('[SW Registration] Full error:', error);
              
              // Provide helpful debugging information
              if (error.name === 'SecurityError') {
                console.error('[SW Registration] üîí Security Error: Service Workers require HTTPS or localhost');
                console.error('[SW Registration] Current protocol:', window.location.protocol);
              } else if (error.name === 'TypeError') {
                console.error('[SW Registration] ‚ö†Ô∏è  Type Error: Check service worker file path');
                console.error('[SW Registration] Attempted path: /goodlift/service-worker.js');
              }
            });
          
          // Log initial service worker controller status
          if (navigator.serviceWorker.controller) {
            console.log('[SW Registration] Page is currently controlled by service worker:', 
              navigator.serviceWorker.controller.scriptURL);
          } else {
            console.log('[SW Registration] Page is not currently controlled by a service worker');
            console.log('[SW Registration] Will be controlled after first registration completes');
          }
        });
      } else {
        console.error('[SW Registration] ‚ùå Service Workers are not supported in this browser');
        console.error('[SW Registration] User Agent:', navigator.userAgent);
        console.error('[SW Registration] Push notifications will not work without service worker support');
      }
    </script>
  </body>
</html>
